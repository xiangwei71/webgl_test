!function(t){var i={};function n(r){if(i[r])return i[r].exports;var e=i[r]={i:r,l:!1,exports:{}};return t[r].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=t,n.c=i,n.d=function(t,i,r){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)n.d(r,e,function(i){return t[i]}.bind(null,e));return r},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=0)}([function(t,i,n){"use strict";n.r(i);function r(t,i){return Math.abs(t-i)<.001}var e=function(){function t(t,i,n){this.x=0,this.y=0,this.z=0,this.x=t,this.y=i,this.z=n}return t.add=function(i,n){return new t(n.x+i.x,n.y+i.y,n.z+i.z)},t.minus=function(i,n){return new t(i.x-n.x,i.y-n.y,i.z-n.z)},t.multiply=function(i,n){return new t(i.x*n,i.y*n,i.z*n)},t.cross=function(i,n){return new t(i.y*n.z-i.z*n.y,-i.x*n.z+i.z*n.x,i.x*n.y-i.y*n.x)},t.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},t.equal=function(t,i){return r(t.x,i.x)&&r(t.y,i.y)&&r(t.z,i.z)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.normalize=function(){var t=this.length();return this.x=this.x/t,this.y=this.y/t,this.z=this.z/t,this},t.prototype.add=function(i){return t.add(this,i)},t.prototype.minus=function(i){return t.minus(this,i)},t.prototype.multiply=function(i){return t.multiply(this,i)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.up=new t(0,1,0),t.zero=new t(0,0,0),t}(),o=function(t,i){this.from=t,this.dir=i},s=function(){function t(t,i,n){this.z_axis=e.minus(i,t).normalize();var r=e.up;this.x_axis=e.cross(r,this.z_axis).normalize(),this.y_axis=e.cross(this.z_axis,this.x_axis),this.eye=t,this.fov_degree=n}return t.prototype.create_ray_dir=function(t,i,n){var r,e=(r=.5*this.fov_degree,Math.PI*r/180),o=Math.tan(e),s=o*n;return this.z_axis.add(this.x_axis.multiply(t*s)).add(this.y_axis.multiply(i*o))},t.prototype.render=function(t,i){var n=this,r=new e(1,-1,0).normalize(),s=.5/t.h,u=[{x:0,y:0},{x:s,y:s},{x:-s,y:s},{x:-s,y:-s},{x:s,y:-s}],h=new e(.5,.5,.5);t.render_pixel((function(t,s,a){var f=n.create_ray_dir(t,s,a),l=u.map((function(t){var i=f.add(n.x_axis.multiply(t.x)).add(n.y_axis.multiply(t.y));return new o(n.eye,i)})).map((function(t){var n,o,s,u=i.map((function(i){return i.hit(t)})).filter((function(t){return t.is_hit})).sort((function(t,i){return t.t-i.t}));if(0!=u.length){var a=u[0].normal,f=(n=-e.dot(r,a),o=0,n>(s=1)?s:n<o?o:n);return new e(f,f,f)}return h})),p=u.length;return l.reduce((function(t,i){return t.add(i)}),e.zero).multiply(1/p)}))},t}(),u=function(){function t(t,i,n){this.plane=t,this.w=i,this.h=n}return t.prototype.hit=function(t){var i=this.plane.hit(t);if(i.is_hit){var n=i.hit_pos,r=n.minus(this.plane.C),o=e.equal(this.plane.N,e.up)?new e(1,0,0):e.up,s=e.cross(o,this.plane.N).normalize(),u=e.cross(s,this.plane.N),h=e.dot(r,s),a=e.dot(r,u);return{is_hit:Math.abs(h)<this.w&&Math.abs(a)<this.h,hit_pos:n,t:i.t,normal:this.plane.N}}return{is_hit:!1}},t}(),h=function(){function t(t,i){this.C=t,this.N=i}return t.prototype.is_positive=function(t){var i=e.minus(t,this.C);return e.dot(i,this.N)>0},t.prototype.hit=function(t){var i=t.from,n=t.dir,o=e.dot(n,this.N),s=e.dot(e.minus(this.C,i),this.N);if(r(o,0))return{is_hit:!1,hit_pos:null,t:-1};var u=s/o;return{is_hit:u>0,hit_pos:i.add(n.multiply(u)),t:u,normal:this.N}},t}(),a=function(){function t(t,i){this.C=t,this.R=i}return t.prototype.hit=function(t){var i=t.dir,n=t.from,o=e.dot(i,i),s=2*(e.dot(i,n)-e.dot(i,this.C)),u=s*s-4*o*(e.dot(n,n)-2*e.dot(n,this.C)+e.dot(this.C,this.C)-this.R*this.R);if(r(u,0)){var h=-s/(2*o),a=(f=n.add(i.multiply(h))).minus(this.C).normalize();return{is_hit:!0,hit_pos:f,t:h,normal:a}}if(u>0){var f,l=Math.sqrt(u);h=[(-s-l)/(2*o),(-s+l)/(2*o)].filter((function(t){return t>0}))[0],a=(f=n.add(i.multiply(h))).minus(this.C).normalize();return{is_hit:!0,hit_pos:f,t:h,normal:a}}return{is_hit:!1}},t}(),f=function(){function t(t,i){void 0===t&&(t=320),void 0===i&&(i=240),this.w=320,this.h=240,this.backbuffer=null,this.w=t,this.h=i,this.backbuffer=new OffscreenCanvas(this.w,this.h)}return t.prototype.render_pixel=function(t){for(var i=this.backbuffer.getContext("2d"),n=i.getImageData(0,0,this.w,this.h),r=n.data,e=this.w/this.h,o=0;o<this.h;++o)for(var s=0;s<this.w;++s){var u=4*(s+o*this.w),h=s/this.w,a=o/this.h,f=t(2*h-1,2*(a=1-a)-1,e),l=f.x,p=f.y,c=f.z;r[u++]=Math.round(255*l),r[u++]=Math.round(255*p),r[u++]=Math.round(255*c),r[u]=255}i.putImageData(n,0,0)},t.prototype.show_buffer=function(t){var i=document.getElementById(t);i.style.width=this.w+"px",i.style.height=this.h+"px",i.width=i.clientWidth,i.height=i.clientHeight,i.getContext("bitmaprenderer").transferFromImageBitmap(this.backbuffer.transferToImageBitmap())},t}();new function(){var t=[new u(new h(e.zero,e.up),16,16),new a(new e(6,2,0),2)],i=new s(new e(0,20,-20),e.zero,60),n=new f(800,600);i.render(n,t),n.show_buffer("canvas")}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL01hdGgvVG9vbC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvTWF0aC9WZWN0b3IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL01hdGgvUmF5LnRzIiwid2VicGFjazovLy8uL3NyYy9NYXRoL0NhbWVyYS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvTWF0aC9SZWN0LnRzIiwid2VicGFjazovLy8uL3NyYy9NYXRoL1BsYW5lLnRzIiwid2VicGFjazovLy8uL3NyYy9NYXRoL1NwaGVyZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvTWF0aC9SZW5kZXJUYXJnZXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL21haW4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0FwcC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIm51bWJlcl9lcXVhbCIsImEiLCJiIiwiTWF0aCIsImFicyIsInB4IiwicHkiLCJweiIsIngiLCJ5IiwieiIsInRoaXMiLCJhZGQiLCJBIiwiQiIsIlZlY3RvciIsIm1pbnVzIiwibXVsdGlwbHkiLCJjcm9zcyIsImRvdCIsImVxdWFsIiwibGVuZ3RoIiwic3FydCIsIm5vcm1hbGl6ZSIsInRlbXAiLCJjbG9uZSIsInVwIiwiemVybyIsImZyb20iLCJkaXIiLCJleWUiLCJsb29rX2F0IiwiZm92X2RlZ3JlZSIsInpfYXhpcyIsImhlbHBfdiIsInhfYXhpcyIsInlfYXhpcyIsImNyZWF0ZV9yYXlfZGlyIiwieF93ZWlnaHQiLCJ5X3dlaWdodCIsInJhdGlvIiwiaGFsZl9mb3ZfcmFkIiwiUEkiLCJ0YW5faCIsInRhbiIsInRhbl93IiwicmVuZGVyIiwicmVuZGVyX3RhcmdldCIsIm9ial9saXN0IiwiZGlyZWN0aW9uX2xpZ2h0X2RpciIsImhhbGZfcGl4ZWxfb2Zmc2V0IiwiaCIsIm11bHRpc2FtcGxlX2RpZmYiLCJncmV5IiwicmVuZGVyX3BpeGVsIiwicmF5X2RpciIsImNvbG9ycyIsIm1hcCIsImRpZmYiLCJyYXkiLCJoaXRfc29ydF9saXN0Iiwib2JqIiwiaGl0IiwiZmlsdGVyIiwiaW5mbyIsImlzX2hpdCIsInNvcnQiLCJub3JtYWwiLCJzdHJlbmd0aCIsImNvdW50IiwicmVkdWNlIiwiYWNjdW11bGF0b3IiLCJjdXJyZW50IiwicGxhbmUiLCJ3IiwicmVzdWx0IiwiaGl0X3BvcyIsIkMiLCJOIiwid19heGlzIiwiaF9heGlzIiwid192YWx1ZSIsImhfdmFsdWUiLCJwb2ludCIsImlzX3Bvc2l0aXZlIiwidGVzdF9wIiwiUiIsIkQiLCJGIiwiayIsInNxcnRfayIsImJhY2tidWZmZXIiLCJPZmZzY3JlZW5DYW52YXMiLCJmdW5jIiwiY29udGV4dF8yZCIsImdldENvbnRleHQiLCJiYWNrYnVmZmVyX2RhdGEiLCJnZXRJbWFnZURhdGEiLCJiYWNrYnVmZmVyX2RhdGFfYXJyYXkiLCJkYXRhIiwiaW5kZXgiLCJYIiwiWSIsImNvbG9yIiwiZyIsInJvdW5kIiwicHV0SW1hZ2VEYXRhIiwic2hvd19idWZmZXIiLCJjYW52YXNfaWQiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsImNsaWVudFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwidHJhbnNmZXJGcm9tSW1hZ2VCaXRtYXAi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c3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGZ1bmN0aW9uIGRlZ3JlZV90b19SYWQoZDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5QSSAqIGQgLyAxODA7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZXBzaWxvbjogbnVtYmVyID0gMC4wMDE7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbnVtYmVyX2VxdWFsKGE6IG51bWJlciwgYjogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5hYnMoYSAtIGIpIDwgZXBzaWxvbjtcclxufVxyXG5cclxuLyoqXHJcbiAqIFxyXG4gKiBAcGFyYW0geCBpbnB1dFxyXG4gKiBAcGFyYW0gYSBtaW4gXHJcbiAqIEBwYXJhbSBiIG1heFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNsYW1wKHg6IG51bWJlciwgYTogbnVtYmVyLCBiOiBudW1iZXIpIHtcclxuICAgIGlmICh4ID4gYilcclxuICAgICAgICByZXR1cm4gYjtcclxuICAgIGVsc2UgaWYgKHggPCBhKVxyXG4gICAgICAgIHJldHVybiBhO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIHJldHVybiB4O1xyXG59IiwiaW1wb3J0IHsgbnVtYmVyX2VxdWFsIH0gZnJvbSAnLi9Ub29sJ1xyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZlY3RvciB7XHJcblxyXG4gICAgc3RhdGljIHVwID0gbmV3IFZlY3RvcigwLCAxLCAwKTtcclxuICAgIHN0YXRpYyB6ZXJvID0gbmV3IFZlY3RvcigwLCAwLCAwKTtcclxuXHJcbiAgICBzdGF0aWMgYWRkKEE6IFZlY3RvciwgQjogVmVjdG9yKSB7XHJcbiAgICAgICAgdmFyIHRlbXAgPSBuZXcgVmVjdG9yKEIueCArIEEueCwgQi55ICsgQS55LCBCLnogKyBBLnopO1xyXG4gICAgICAgIHJldHVybiB0ZW1wXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIG1pbnVzKEE6IFZlY3RvciwgQjogVmVjdG9yKSB7XHJcbiAgICAgICAgdmFyIHRlbXAgPSBuZXcgVmVjdG9yKEEueCAtIEIueCwgQS55IC0gQi55LCBBLnogLSBCLnopO1xyXG4gICAgICAgIHJldHVybiB0ZW1wXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIG11bHRpcGx5KEE6IFZlY3RvciwgczogbnVtYmVyKSB7XHJcbiAgICAgICAgdmFyIHRlbXAgPSBuZXcgVmVjdG9yKEEueCAqIHMsIEEueSAqIHMsIEEueiAqIHMpO1xyXG4gICAgICAgIHJldHVybiB0ZW1wXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGNyb3NzKEE6IFZlY3RvciwgQjogVmVjdG9yKSB7XHJcbiAgICAgICAgdmFyIHRlbXAgPSBuZXcgVmVjdG9yKEEueSAqIEIueiAtIEEueiAqIEIueSwgLUEueCAqIEIueiArIEEueiAqIEIueCwgQS54ICogQi55IC0gQS55ICogQi54KTtcclxuICAgICAgICByZXR1cm4gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZG90KEE6IFZlY3RvciwgQjogVmVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIEEueCAqIEIueCArIEEueSAqIEIueSArIEEueiAqIEIuejtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZXF1YWwoQTogVmVjdG9yLCBCOiBWZWN0b3IpIHtcclxuICAgICAgICByZXR1cm4gbnVtYmVyX2VxdWFsKEEueCwgQi54KSAmJiBudW1iZXJfZXF1YWwoQS55LCBCLnkpICYmIG51bWJlcl9lcXVhbChBLnosIEIueik7XHJcbiAgICB9XHJcblxyXG4gICAgeDogbnVtYmVyID0gMDtcclxuICAgIHk6IG51bWJlciA9IDA7XHJcbiAgICB6OiBudW1iZXIgPSAwO1xyXG4gICAgY29uc3RydWN0b3IocHg6IG51bWJlciwgcHk6IG51bWJlciwgcHo6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMueCA9IHB4O1xyXG4gICAgICAgIHRoaXMueSA9IHB5O1xyXG4gICAgICAgIHRoaXMueiA9IHB6O1xyXG4gICAgfVxyXG5cclxuICAgIGxlbmd0aCgpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueik7XHJcbiAgICB9XHJcblxyXG4gICAgbm9ybWFsaXplKCkge1xyXG4gICAgICAgIHZhciB0ZW1wID0gdGhpcy5sZW5ndGgoKTtcclxuICAgICAgICB0aGlzLnggPSB0aGlzLnggLyB0ZW1wO1xyXG4gICAgICAgIHRoaXMueSA9IHRoaXMueSAvIHRlbXA7XHJcbiAgICAgICAgdGhpcy56ID0gdGhpcy56IC8gdGVtcDtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBhZGQoQTogVmVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFZlY3Rvci5hZGQodGhpcywgQSk7XHJcbiAgICB9XHJcblxyXG4gICAgbWludXMoQTogVmVjdG9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFZlY3Rvci5taW51cyh0aGlzLCBBKTtcclxuICAgIH1cclxuXHJcbiAgICBtdWx0aXBseShzOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gVmVjdG9yLm11bHRpcGx5KHRoaXMsIHMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yKHRoaXMueCwgdGhpcy55LCB0aGlzLnopO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IFZlY29yIGZyb20gXCIuL1ZlY3RvclwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmF5IHtcclxuICAgIGZyb206IFZlY29yO1xyXG4gICAgZGlyOiBWZWNvcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihmcm9tOiBWZWNvciwgZGlyOiBWZWNvcikge1xyXG4gICAgICAgIHRoaXMuZnJvbSA9IGZyb207XHJcbiAgICAgICAgdGhpcy5kaXIgPSBkaXI7XHJcbiAgICB9XHJcbn07IiwiaW1wb3J0IFZlY3RvciBmcm9tIFwiLi9WZWN0b3JcIjtcclxuaW1wb3J0IFJheSBmcm9tIFwiLi9SYXlcIjtcclxuaW1wb3J0IHsgZGVncmVlX3RvX1JhZCwgY2xhbXAgfSBmcm9tIFwiLi9Ub29sXCJcclxuaW1wb3J0IFJlbmRlclRhcmdldCBmcm9tIFwiLi9SZW5kZXJUYXJnZXRcIjtcclxuaW1wb3J0IEhpdGFibGUgZnJvbSBcIi4vSGl0YWJsZVwiO1xyXG5pbXBvcnQgSGl0SW5mbyBmcm9tIFwiLi9IaXRJbmZvXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYW1lcmEge1xyXG4gICAgZXllOiBWZWN0b3I7XHJcblxyXG4gICAgeF9heGlzOiBWZWN0b3I7XHJcbiAgICB5X2F4aXM6IFZlY3RvcjtcclxuICAgIHpfYXhpczogVmVjdG9yO1xyXG5cclxuICAgIGZvdl9kZWdyZWU6IG51bWJlcjtcclxuICAgIGNvbnN0cnVjdG9yKGV5ZTogVmVjdG9yLCBsb29rX2F0OiBWZWN0b3IsIGZvdl9kZWdyZWU6IG51bWJlcikge1xyXG5cclxuICAgICAgICAvLyBjYW1lcmEgM+i7uFxyXG4gICAgICAgIHRoaXMuel9heGlzID0gVmVjdG9yLm1pbnVzKGxvb2tfYXQsIGV5ZSkubm9ybWFsaXplKCk7XHJcblxyXG4gICAgICAgIGxldCBoZWxwX3YgPSBWZWN0b3IudXA7XHJcbiAgICAgICAgdGhpcy54X2F4aXMgPSBWZWN0b3IuY3Jvc3MoaGVscF92LCB0aGlzLnpfYXhpcykubm9ybWFsaXplKCk7XHJcbiAgICAgICAgdGhpcy55X2F4aXMgPSBWZWN0b3IuY3Jvc3ModGhpcy56X2F4aXMsIHRoaXMueF9heGlzKTtcclxuXHJcbiAgICAgICAgLy8gY2FtZXJhIOWOn+m7nlxyXG4gICAgICAgIHRoaXMuZXllID0gZXllO1xyXG5cclxuICAgICAgICAvLyBjYW1lcmEgZm92XHJcbiAgICAgICAgdGhpcy5mb3ZfZGVncmVlID0gZm92X2RlZ3JlZTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVfcmF5X2Rpcih4X3dlaWdodDogbnVtYmVyLCB5X3dlaWdodDogbnVtYmVyLCByYXRpbzogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGhhbGZfZm92X3JhZCA9IGRlZ3JlZV90b19SYWQoMC41ICogdGhpcy5mb3ZfZGVncmVlKTtcclxuICAgICAgICBsZXQgdGFuX2ggPSBNYXRoLnRhbihoYWxmX2Zvdl9yYWQpO1xyXG4gICAgICAgIGxldCB0YW5fdyA9IHRhbl9oICogcmF0aW87XHJcblxyXG4gICAgICAgIGxldCBkaXIgPSB0aGlzLnpfYXhpc1xyXG4gICAgICAgICAgICAuYWRkKHRoaXMueF9heGlzLm11bHRpcGx5KHhfd2VpZ2h0ICogdGFuX3cpKVxyXG4gICAgICAgICAgICAuYWRkKHRoaXMueV9heGlzLm11bHRpcGx5KHlfd2VpZ2h0ICogdGFuX2gpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRpcjtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXIocmVuZGVyX3RhcmdldDogUmVuZGVyVGFyZ2V0LCBvYmpfbGlzdDogSGl0YWJsZVtdKSB7XHJcbiAgICAgICAgbGV0IGRpcmVjdGlvbl9saWdodF9kaXIgPSBuZXcgVmVjdG9yKDEsIC0xLCAwKS5ub3JtYWxpemUoKTtcclxuXHJcbiAgICAgICAgbGV0IGhhbGZfcGl4ZWxfb2Zmc2V0ID0gMC41IC8gcmVuZGVyX3RhcmdldC5oO1xyXG4gICAgICAgIGxldCBtdWx0aXNhbXBsZV9kaWZmID0gW1xyXG4gICAgICAgICAgICB7IHg6IDAsIHk6IDAgfSxcclxuICAgICAgICAgICAgeyB4OiBoYWxmX3BpeGVsX29mZnNldCwgeTogaGFsZl9waXhlbF9vZmZzZXQgfSxcclxuICAgICAgICAgICAgeyB4OiAtaGFsZl9waXhlbF9vZmZzZXQsIHk6IGhhbGZfcGl4ZWxfb2Zmc2V0IH0sXHJcbiAgICAgICAgICAgIHsgeDogLWhhbGZfcGl4ZWxfb2Zmc2V0LCB5OiAtaGFsZl9waXhlbF9vZmZzZXQgfSxcclxuICAgICAgICAgICAgeyB4OiBoYWxmX3BpeGVsX29mZnNldCwgeTogLWhhbGZfcGl4ZWxfb2Zmc2V0IH0sXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgbGV0IGdyZXkgPSBuZXcgVmVjdG9yKDAuNSwgMC41LCAwLjUpO1xyXG5cclxuICAgICAgICByZW5kZXJfdGFyZ2V0LnJlbmRlcl9waXhlbCgoeF93ZWlnaHQ6IG51bWJlciwgeV93ZWlnaHQ6IG51bWJlciwgcmF0aW86IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcmF5X2RpciA9IHRoaXMuY3JlYXRlX3JheV9kaXIoeF93ZWlnaHQsIHlfd2VpZ2h0LCByYXRpbyk7XHJcblxyXG4gICAgICAgICAgICAvLyDnlKLnlJ/lpJrmop1yYXlcclxuICAgICAgICAgICAgbGV0IHJheXMgPSBtdWx0aXNhbXBsZV9kaWZmLm1hcChkaWZmID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIOWwjXJheV9kcmnkvZzlgY/np7tcclxuICAgICAgICAgICAgICAgIGxldCBkaXIgPSByYXlfZGlyLmFkZCh0aGlzLnhfYXhpcy5tdWx0aXBseShkaWZmLngpKS5hZGQodGhpcy55X2F4aXMubXVsdGlwbHkoZGlmZi55KSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmF5KHRoaXMuZXllLCBkaXIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy8g5q+P5YCLcmF56YO9566XY29sb3JcclxuICAgICAgICAgICAgbGV0IGNvbG9ycyA9IHJheXMubWFwKHJheSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaGl0X3NvcnRfbGlzdCA9IG9ial9saXN0Lm1hcChvYmogPT4gb2JqLmhpdChyYXkpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoaW5mbyA9PiBpbmZvLmlzX2hpdClcclxuICAgICAgICAgICAgICAgICAgICAuc29ydCgoYTogSGl0SW5mbywgYjogSGl0SW5mbykgPT4gYS50IC0gYi50KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyDmnInlsITkuK3ll45cclxuICAgICAgICAgICAgICAgIGxldCBpc19oaXQgPSBoaXRfc29ydF9saXN0Lmxlbmd0aCAhPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzX2hpdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBoaXRfc29ydF9saXN0WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBuID0gcmVzdWx0Lm5vcm1hbDtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3RyZW5ndGggPSBjbGFtcCgtVmVjdG9yLmRvdChkaXJlY3Rpb25fbGlnaHRfZGlyLCBuKSwgMCwgMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yKHN0cmVuZ3RoLCBzdHJlbmd0aCwgc3RyZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ3JleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyDlj5blubPlnYflsLHmnIlBbnRpYWxpYXNpbmfmlYjmnpxcclxuICAgICAgICAgICAgbGV0IGNvdW50ID0gbXVsdGlzYW1wbGVfZGlmZi5sZW5ndGg7XHJcbiAgICAgICAgICAgIGxldCBmaW5hbF9jb2xvciA9IGNvbG9ycy5yZWR1Y2UoKGFjY3VtdWxhdG9yOiBWZWN0b3IsIGN1cnJlbnQ6IFZlY3RvcikgPT4gYWNjdW11bGF0b3IuYWRkKGN1cnJlbnQpLCBWZWN0b3IuemVybykubXVsdGlwbHkoMSAvIGNvdW50KTtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbmFsX2NvbG9yO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgUGxhbmUgZnJvbSBcIi4vUGxhbmVcIjtcclxuaW1wb3J0IFJheSBmcm9tIFwiLi9SYXlcIjtcclxuaW1wb3J0IFZlY3RvciBmcm9tIFwiLi9WZWN0b3JcIjtcclxuaW1wb3J0IEhpdEluZm8gZnJvbSBcIi4vSGl0SW5mb1wiO1xyXG5pbXBvcnQgSGl0YWJsZSBmcm9tIFwiLi9IaXRhYmxlXCI7XHJcblxyXG4vLyDlsI/mlrnloYpcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVjdCBpbXBsZW1lbnRzIEhpdGFibGUge1xyXG4gICAgcGxhbmU6IFBsYW5lO1xyXG4gICAgdzogbnVtYmVyO1xyXG4gICAgaDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHBsYW5lOiBQbGFuZSwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLnBsYW5lID0gcGxhbmU7XHJcbiAgICAgICAgdGhpcy53ID0gdztcclxuICAgICAgICB0aGlzLmggPSBoO1xyXG4gICAgfVxyXG5cclxuICAgIGhpdChyYXk6IFJheSk6IEhpdEluZm8ge1xyXG4gICAgICAgIGxldCByZXN1bHQgPSB0aGlzLnBsYW5lLmhpdChyYXkpO1xyXG4gICAgICAgIGlmIChyZXN1bHQuaXNfaGl0KSB7XHJcbiAgICAgICAgICAgIGxldCBoaXRfcG9zID0gcmVzdWx0LmhpdF9wb3M7XHJcbiAgICAgICAgICAgIGxldCBkaWZmID0gaGl0X3Bvcy5taW51cyh0aGlzLnBsYW5lLkMpO1xyXG5cclxuICAgICAgICAgICAgLy8g6YG/6ZaL55u4562J55qE5oOF5rOBXHJcbiAgICAgICAgICAgIGxldCBoZWxwX3YgPSBWZWN0b3IuZXF1YWwodGhpcy5wbGFuZS5OLCBWZWN0b3IudXApID8gbmV3IFZlY3RvcigxLCAwLCAwKSA6IFZlY3Rvci51cDtcclxuXHJcbiAgICAgICAgICAgIGxldCB3X2F4aXMgPSBWZWN0b3IuY3Jvc3MoaGVscF92LCB0aGlzLnBsYW5lLk4pLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgICAgICBsZXQgaF9heGlzID0gVmVjdG9yLmNyb3NzKHdfYXhpcywgdGhpcy5wbGFuZS5OKTtcclxuICAgICAgICAgICAgbGV0IHdfdmFsdWUgPSBWZWN0b3IuZG90KGRpZmYsIHdfYXhpcyk7XHJcbiAgICAgICAgICAgIGxldCBoX3ZhbHVlID0gVmVjdG9yLmRvdChkaWZmLCBoX2F4aXMpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGlzX2hpdCA9IE1hdGguYWJzKHdfdmFsdWUpIDwgdGhpcy53ICYmIE1hdGguYWJzKGhfdmFsdWUpIDwgdGhpcy5oO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaXNfaGl0LFxyXG4gICAgICAgICAgICAgICAgaGl0X3BvcyxcclxuICAgICAgICAgICAgICAgIHQ6IHJlc3VsdC50LFxyXG4gICAgICAgICAgICAgICAgbm9ybWFsOiB0aGlzLnBsYW5lLk5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBpc19oaXQ6IGZhbHNlLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IFZlY3RvciBmcm9tICcuL1ZlY3Rvcic7XHJcbmltcG9ydCBSYXkgZnJvbSAnLi9SYXknO1xyXG5pbXBvcnQgeyBudW1iZXJfZXF1YWwgfSBmcm9tICcuL1Rvb2wnO1xyXG5pbXBvcnQgSGl0SW5mbyBmcm9tICcuL0hpdEluZm8nO1xyXG5pbXBvcnQgSGl0YWJsZSBmcm9tICcuL0hpdGFibGUnO1xyXG5cclxuLy8g5bmz6Z2iXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsYW5lIGltcGxlbWVudHMgSGl0YWJsZSB7XHJcblxyXG4gICAgQzogVmVjdG9yO1xyXG4gICAgTjogVmVjdG9yO1xyXG4gICAgY29uc3RydWN0b3IocG9pbnQ6IFZlY3Rvciwgbm9ybWFsOiBWZWN0b3IpIHtcclxuICAgICAgICB0aGlzLkMgPSBwb2ludDtcclxuICAgICAgICB0aGlzLk4gPSBub3JtYWw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5ris6KmmdGVzcF9w5ZKM5pa55ZCR6YeP5piv5LiN5piv5Zyo5ZCM5LiA6YKKXHJcbiAgICBpc19wb3NpdGl2ZSh0ZXN0X3A6IFZlY3Rvcikge1xyXG4gICAgICAgIGxldCBkaWZmID0gVmVjdG9yLm1pbnVzKHRlc3RfcCwgdGhpcy5DKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBWZWN0b3IuZG90KGRpZmYsIHRoaXMuTik7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlID4gMDtcclxuICAgIH1cclxuXHJcbiAgICBoaXQocmF5OiBSYXkpOiBIaXRJbmZvIHtcclxuICAgICAgICAvLyByYXkgaGl0IHBsYW5lIFxyXG4gICAgICAgIGxldCBmcm9tID0gcmF5LmZyb207XHJcbiAgICAgICAgbGV0IGRpciA9IHJheS5kaXI7XHJcblxyXG4gICAgICAgIC8vIChGLUMp44CCTiArIHQgKETjgIJOKSA9IDBcclxuICAgICAgICAvLyB0ICA9IChDLUYp44CCTiAvIChE44CCTilcclxuICAgICAgICAvLyB0ICA9IChBIC8gKEIpXHJcbiAgICAgICAgbGV0IEIgPSBWZWN0b3IuZG90KGRpciwgdGhpcy5OKTtcclxuICAgICAgICBsZXQgQSA9IFZlY3Rvci5kb3QoVmVjdG9yLm1pbnVzKHRoaXMuQywgZnJvbSksIHRoaXMuTik7XHJcblxyXG4gICAgICAgIC8vIGF2b2lkIGRpdmlkZSBieSAwXHJcbiAgICAgICAgaWYgKG51bWJlcl9lcXVhbChCLCAwKSlcclxuICAgICAgICAgICAgcmV0dXJuIHsgaXNfaGl0OiBmYWxzZSwgaGl0X3BvczogbnVsbCwgdDogLTEgfTtcclxuXHJcbiAgICAgICAgbGV0IHQgPSBBIC8gQjtcclxuICAgICAgICBsZXQgaXNfaGl0ID0gdCA+IDAuMDtcclxuICAgICAgICBsZXQgaGl0X3BvcyA9IGZyb20uYWRkKGRpci5tdWx0aXBseSh0KSk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaXNfaGl0LFxyXG4gICAgICAgICAgICBoaXRfcG9zLFxyXG4gICAgICAgICAgICB0LFxyXG4gICAgICAgICAgICBub3JtYWw6IHRoaXMuTixcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgVmVjdG9yIGZyb20gXCIuL1ZlY3RvclwiO1xyXG5pbXBvcnQgUmF5IGZyb20gXCIuL1JheVwiO1xyXG5pbXBvcnQgeyBudW1iZXJfZXF1YWwgfSBmcm9tICcuL1Rvb2wnO1xyXG5pbXBvcnQgSGl0SW5mbyBmcm9tIFwiLi9IaXRJbmZvXCI7XHJcbmltcG9ydCBIaXRhYmxlIGZyb20gXCIuL0hpdGFibGVcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNwaGVyZSBpbXBsZW1lbnRzIEhpdGFibGUge1xyXG5cclxuICAgIEM6IFZlY3RvcjsgLy8g55CD5Lit5b+DXHJcbiAgICBSOiBudW1iZXI7IC8vIOeQg+WNiuW+kVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKEM6IFZlY3RvciwgUjogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5DID0gQztcclxuICAgICAgICB0aGlzLlIgPSBSO1xyXG4gICAgfVxyXG5cclxuICAgIGhpdChyYXk6IFJheSk6IEhpdEluZm8ge1xyXG4gICAgICAgIC8vIOinozLmrKHmlrnnqIvlvI9cclxuICAgICAgICAvLyAoWC1DKeOAgihYLUMpID0gUipSXHJcbiAgICAgICAgLy8gWD1GK3QqRFxyXG4gICAgICAgIC8vIHQ9WygtYi1zcXJ0X2spLzJhLCgtYitzcXJ0X2spLzJhXVxyXG4gICAgICAgIGxldCBEID0gcmF5LmRpcjtcclxuICAgICAgICBsZXQgRiA9IHJheS5mcm9tO1xyXG4gICAgICAgIGxldCBhID0gVmVjdG9yLmRvdChELCBEKTtcclxuICAgICAgICBsZXQgYiA9IDIgKiAoVmVjdG9yLmRvdChELCBGKSAtIFZlY3Rvci5kb3QoRCwgdGhpcy5DKSk7XHJcbiAgICAgICAgbGV0IGMgPSBWZWN0b3IuZG90KEYsIEYpIC0gMiAqIFZlY3Rvci5kb3QoRiwgdGhpcy5DKSArIFZlY3Rvci5kb3QodGhpcy5DLCB0aGlzLkMpIC0gdGhpcy5SICogdGhpcy5SO1xyXG5cclxuICAgICAgICBsZXQgayA9IGIgKiBiIC0gNCAqIGEgKiBjO1xyXG4gICAgICAgIGlmIChudW1iZXJfZXF1YWwoaywgMCkpIHsgIC8vIOS6pOaWvDHpu55cclxuICAgICAgICAgICAgbGV0IHQgPSAtYiAvICgyICogYSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgaGl0X3BvcyA9IEYuYWRkKEQubXVsdGlwbHkodCkpO1xyXG4gICAgICAgICAgICBsZXQgbm9ybWFsID0gaGl0X3Bvcy5taW51cyh0aGlzLkMpLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaXNfaGl0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgaGl0X3BvcyxcclxuICAgICAgICAgICAgICAgIHQsXHJcbiAgICAgICAgICAgICAgICBub3JtYWxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChrID4gMCkgeyAvLyDkuqTmlrwy6bueXHJcblxyXG4gICAgICAgICAgICAvLyDpgY7mv77lh7p0PjDvvIxyYXkuZnJvbeWcqOeQg+WFp+eQg+acieWPr+iDveWHuuePvnQ8MFxyXG4gICAgICAgICAgICBsZXQgc3FydF9rID0gTWF0aC5zcXJ0KGspO1xyXG4gICAgICAgICAgICBsZXQgdF9saXN0ID0gWygtYiAtIHNxcnRfaykgLyAoMiAqIGEpLCAoLWIgKyBzcXJ0X2spIC8gKDIgKiBhKV0uZmlsdGVyKHggPT4geCA+IDApO1xyXG4gICAgICAgICAgICBsZXQgdCA9IHRfbGlzdFswXTtcclxuICAgICAgICAgICAgbGV0IGhpdF9wb3MgPSBGLmFkZChELm11bHRpcGx5KHQpKTtcclxuICAgICAgICAgICAgbGV0IG5vcm1hbCA9IGhpdF9wb3MubWludXModGhpcy5DKS5ub3JtYWxpemUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlzX2hpdDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGhpdF9wb3MsXHJcbiAgICAgICAgICAgICAgICB0LFxyXG4gICAgICAgICAgICAgICAgbm9ybWFsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgeyAvLyDmspLkuqTpu55cclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGlzX2hpdDogZmFsc2UsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgVmVjdG9yIGZyb20gXCIuL1ZlY3RvclwiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZW5kZXJUYXJnZXQge1xyXG4gICAgdzogbnVtYmVyID0gMzIwO1xyXG4gICAgaDogbnVtYmVyID0gMjQwO1xyXG4gICAgYmFja2J1ZmZlcjogT2Zmc2NyZWVuQ2FudmFzID0gbnVsbDtcclxuICAgIGNvbnN0cnVjdG9yKHc6IG51bWJlciA9IDMyMCwgaDogbnVtYmVyID0gMjQwKSB7XHJcbiAgICAgICAgdGhpcy53ID0gdztcclxuICAgICAgICB0aGlzLmggPSBoO1xyXG4gICAgICAgIHRoaXMuYmFja2J1ZmZlciA9IG5ldyBPZmZzY3JlZW5DYW52YXModGhpcy53LCB0aGlzLmgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcl9waXhlbChmdW5jOiAoeF93ZWlnaHQ6IG51bWJlciwgeV93ZWlnaHQ6IG51bWJlciwgcmF0aW86IG51bWJlcikgPT4gVmVjdG9yKSB7XHJcblxyXG4gICAgICAgIGxldCBjb250ZXh0XzJkID0gdGhpcy5iYWNrYnVmZmVyLmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgICAgIC8vIGdldCBzb3VyY2UgZGF0YSBhcnJheVxyXG4gICAgICAgIGxldCBiYWNrYnVmZmVyX2RhdGEgPSBjb250ZXh0XzJkLmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLncsIHRoaXMuaCk7XHJcbiAgICAgICAgbGV0IGJhY2tidWZmZXJfZGF0YV9hcnJheSA9IGJhY2tidWZmZXJfZGF0YS5kYXRhO1xyXG5cclxuICAgICAgICBsZXQgcmF0aW8gPSB0aGlzLncgLyB0aGlzLmg7XHJcblxyXG4gICAgICAgIC8vIHNldCBhcnJheSB2YWx1ZVxyXG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5oOyArK3kpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLnc7ICsreCkge1xyXG4gICAgICAgICAgICAgICAgLy8gcmdiYSBlYWNoIGNvbG9yIGlzIDRieXRlXHJcbiAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSA0ICogKHggKyB5ICogdGhpcy53KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZW1hcCB0byAwfjFcclxuICAgICAgICAgICAgICAgIGxldCBYID0gKHggLyB0aGlzLncpO1xyXG4gICAgICAgICAgICAgICAgbGV0IFkgPSAoeSAvIHRoaXMuaCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY2hhbmdlIHkgZGlyZWN0aW9uXHJcbiAgICAgICAgICAgICAgICBZID0gMSAtIFk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmVtYXAgdG8gLTF+MVxyXG4gICAgICAgICAgICAgICAgbGV0IHhfd2VpZ2h0ID0gWCAqIDIgLSAxO1xyXG4gICAgICAgICAgICAgICAgbGV0IHlfd2VpZ2h0ID0gWSAqIDIgLSAxO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBjb2xvciA9IGZ1bmMoeF93ZWlnaHQsIHlfd2VpZ2h0LCByYXRpbyk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBjb2xvci54O1xyXG4gICAgICAgICAgICAgICAgbGV0IGcgPSBjb2xvci55O1xyXG4gICAgICAgICAgICAgICAgbGV0IGIgPSBjb2xvci56O1xyXG5cclxuICAgICAgICAgICAgICAgIGJhY2tidWZmZXJfZGF0YV9hcnJheVtpbmRleCsrXSA9IE1hdGgucm91bmQociAqIDI1NSk7XHJcbiAgICAgICAgICAgICAgICBiYWNrYnVmZmVyX2RhdGFfYXJyYXlbaW5kZXgrK10gPSBNYXRoLnJvdW5kKGcgKiAyNTUpO1xyXG4gICAgICAgICAgICAgICAgYmFja2J1ZmZlcl9kYXRhX2FycmF5W2luZGV4KytdID0gTWF0aC5yb3VuZChiICogMjU1KTtcclxuICAgICAgICAgICAgICAgIGJhY2tidWZmZXJfZGF0YV9hcnJheVtpbmRleF0gPSAyNTU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGV4dF8yZC5wdXRJbWFnZURhdGEoYmFja2J1ZmZlcl9kYXRhLCAwLCAwKTtcclxuICAgIH1cclxuXHJcbiAgICBzaG93X2J1ZmZlcihjYW52YXNfaWQ6IHN0cmluZykge1xyXG4gICAgICAgIC8vIOioreWummJ1ZmZlcueahOWkp+Wwj+WSjGNzcyBzdHlsZeeahOWkp+Wwj+S4gOaoo1xyXG4gICAgICAgIC8vIGh0dHBzOi8vb3BlbmhvbWUuY2MvR29zc2lwL1dlYkdML0NhbnZhcy5odG1sXHJcbiAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhc19pZCkgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcbiAgICAgICAgY2FudmFzLnN0eWxlLndpZHRoID0gdGhpcy53ICsgJ3B4JztcclxuICAgICAgICBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gdGhpcy5oICsgJ3B4JztcclxuICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuY2xpZW50V2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGNhbnZhcy5jbGllbnRIZWlnaHQ7XHJcblxyXG4gICAgICAgIC8vIGNvcHkgYmFja2J1ZmZlciB0byBjYW52YXNcclxuICAgICAgICBsZXQgY29udGV4dF9iaXRtYXBfcmVuZGVyID0gY2FudmFzLmdldENvbnRleHQoXCJiaXRtYXByZW5kZXJlclwiKTtcclxuICAgICAgICBjb250ZXh0X2JpdG1hcF9yZW5kZXIudHJhbnNmZXJGcm9tSW1hZ2VCaXRtYXAodGhpcy5iYWNrYnVmZmVyLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpKTtcclxuICAgIH1cclxufSIsImltcG9ydCBBcHAgZnJvbSAnLi9BcHAnO1xyXG5cclxubmV3IEFwcCgpOyIsImltcG9ydCBWZWN0b3IgZnJvbSAnLi9NYXRoL1ZlY3RvcidcclxuaW1wb3J0IENhbWVyYSBmcm9tICcuL01hdGgvQ2FtZXJhJ1xyXG5pbXBvcnQgUmVjdCBmcm9tICcuL01hdGgvUmVjdCc7XHJcbmltcG9ydCBQbGFuZSBmcm9tICcuL01hdGgvUGxhbmUnO1xyXG5pbXBvcnQgU3BoZXJlIGZyb20gJy4vTWF0aC9TcGhlcmUnO1xyXG5pbXBvcnQgUmVuZGVyVGFyZ2V0IGZyb20gJy4vTWF0aC9SZW5kZXJUYXJnZXQnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBwIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgICAgICBsZXQgcmVjdCA9IG5ldyBSZWN0KG5ldyBQbGFuZShWZWN0b3IuemVybywgVmVjdG9yLnVwKSwgMTYsIDE2KTtcclxuICAgICAgICBsZXQgc3BoZXJlID0gbmV3IFNwaGVyZShuZXcgVmVjdG9yKDYsIDIsIDApLCAyKTtcclxuICAgICAgICBsZXQgb2JqX2xpc3QgPSBbcmVjdCwgc3BoZXJlXTtcclxuXHJcbiAgICAgICAgbGV0IGNhbWVyYSA9IG5ldyBDYW1lcmEobmV3IFZlY3RvcigwLCAyMCwgLTIwKSwgVmVjdG9yLnplcm8sIDYwKTtcclxuICAgICAgICBsZXQgcmVuZGVyX3RhcmdldCA9IG5ldyBSZW5kZXJUYXJnZXQoODAwLCA2MDApO1xyXG4gICAgICAgIGNhbWVyYS5yZW5kZXIocmVuZGVyX3RhcmdldCwgb2JqX2xpc3QpO1xyXG4gICAgICAgIHJlbmRlcl90YXJnZXQuc2hvd19idWZmZXIoJ2NhbnZhcycpO1xyXG4gICAgfVxyXG59XHJcblxyXG4iXSwic291cmNlUm9vdCI6IiJ9